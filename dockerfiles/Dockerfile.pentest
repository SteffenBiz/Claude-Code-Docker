# Pentesting Profile
FROM claude-code-docker:base

# Als root f√ºr Installationen
USER root

# Pentesting Repositories
RUN sudo apt-get update && sudo apt-get install -y \
    software-properties-common \
    && sudo add-apt-repository ppa:apt-fast/stable -y \
    && sudo apt-get update \
    && sudo apt-get install -y apt-fast \
    && sudo rm -rf /var/lib/apt/lists/*

# Network Analysis Tools
RUN sudo apt-get update && sudo apt-get install -y \
    nmap \
    masscan \
    netcat-traditional \
    socat \
    tcpdump \
    wireshark-common \
    tshark \
    arp-scan \
    nbtscan \
    dnsrecon \
    dnsenum \
    fierce \
    theharvester \
    && sudo rm -rf /var/lib/apt/lists/*

# Web Application Testing
RUN sudo apt-get update && sudo apt-get install -y \
    nikto \
    dirb \
    wfuzz \
    gobuster \
    sqlmap \
    w3af-console \
    && sudo rm -rf /var/lib/apt/lists/*

# Vulnerability Scanning
RUN sudo apt-get update && sudo apt-get install -y \
    lynis \
    chkrootkit \
    rkhunter \
    && sudo rm -rf /var/lib/apt/lists/*

# Password Attacks
RUN sudo apt-get update && sudo apt-get install -y \
    john \
    john-data \
    hashcat \
    hydra \
    medusa \
    && sudo rm -rf /var/lib/apt/lists/*

# Forensics
RUN sudo apt-get update && sudo apt-get install -y \
    binwalk \
    exiftool \
    steghide \
    foremost \
    && sudo rm -rf /var/lib/apt/lists/*

# Exploitation Tools (f√ºr Bildungszwecke)
RUN sudo apt-get update && sudo apt-get install -y \
    metasploit-framework \
    && sudo rm -rf /var/lib/apt/lists/*

# Python Security Tools
RUN pip3 install \
    scapy \
    impacket \
    pwntools \
    requests \
    beautifulsoup4 \
    paramiko \
    pyshark \
    python-nmap \
    shodan \
    censys \
    pymetasploit3 \
    volatility3 \
    yara-python

# Additional Security Analysis Tools
RUN sudo apt-get update && sudo apt-get install -y \
    # Binary Analysis
    radare2 \
    hexedit \
    xxd \
    # System Analysis  
    strace \
    ltrace \
    sysdig \
    # Crypto
    openssl \
    gnutls-bin \
    && sudo rm -rf /var/lib/apt/lists/*

# Burp Suite Community (headless)
RUN wget "https://portswigger.net/burp/releases/download?product=community&type=jar" -O /opt/burpsuite.jar \
    && echo '#!/bin/bash\njava -jar /opt/burpsuite.jar "$@"' | sudo tee /usr/local/bin/burpsuite \
    && sudo chmod +x /usr/local/bin/burpsuite

# OWASP ZAP (headless)
RUN wget https://github.com/zaproxy/zaproxy/releases/download/v2.14.0/ZAP_2.14.0_Linux.tar.gz \
    && sudo tar -xzf ZAP_2.14.0_Linux.tar.gz -C /opt \
    && rm ZAP_2.14.0_Linux.tar.gz \
    && sudo ln -s /opt/ZAP_2.14.0/zap.sh /usr/local/bin/zap

# Wordlists
RUN sudo mkdir -p /usr/share/wordlists \
    && cd /usr/share/wordlists \
    && sudo wget https://github.com/danielmiessler/SecLists/archive/master.zip \
    && sudo unzip master.zip \
    && sudo mv SecLists-master SecLists \
    && sudo rm master.zip

# Go Tools f√ºr Security - als claude user
USER claude
RUN go install github.com/tomnomnom/assetfinder@latest \
    && go install github.com/tomnomnom/httprobe@latest \
    && go install github.com/tomnomnom/waybackurls@latest \
    && go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest \
    && go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest \
    && echo 'export PATH="$HOME/go/bin:$PATH"' >> ~/.bashrc
USER root

# Sicherheitshinweis
RUN echo '#!/bin/bash' | sudo tee /usr/local/bin/pentest-warning \
    && echo 'echo "‚ö†Ô∏è  WARNUNG: Diese Tools nur f√ºr autorisierte Sicherheitstests verwenden!"' | sudo tee -a /usr/local/bin/pentest-warning \
    && echo 'echo "üìã Immer schriftliche Genehmigung einholen vor Tests!"' | sudo tee -a /usr/local/bin/pentest-warning \
    && echo 'echo "üîí Verantwortungsvoller Umgang mit Sicherheitstools!"' | sudo tee -a /usr/local/bin/pentest-warning \
    && sudo chmod +x /usr/local/bin/pentest-warning \
    && echo '/usr/local/bin/pentest-warning' >> /home/claude/.bashrc

# Profil-spezifische Konfiguration
ENV CLAUDE_PROFILE=pentest

# Zur√ºck zu claude user
USER claude
WORKDIR /home/claude